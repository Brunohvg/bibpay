{% extends 'base.html' %}

{% block title %}
    {% if payment_link.status == 'expired' %}
        Link Expirado
    {% elif payment_link.status == 'canceled' %}
        Link Cancelado
    {% else %}
        Link Indisponível
    {% endif %}
{% endblock %}

{% block content %}
<div class="status-page">

    <!-- HEADER -->
    <div class="status-header">
        {% if payment_link.status == 'expired' %}
            <div class="status-icon-lg warning">
                <i class="bi bi-hourglass-bottom"></i>
            </div>
            <h2>Link Expirado</h2>
            <p>O prazo para pagamento deste link encerrou.</p>

        {% elif payment_link.status == 'canceled' %}
            <div class="status-icon-lg danger">
                <i class="bi bi-x-lg"></i>
            </div>
            <h2>Link Cancelado</h2>
            <p>Este link foi cancelado e não pode mais ser utilizado.</p>

        {% else %}
            <div class="status-icon-lg danger">
                <i class="bi bi-x-circle"></i>
            </div>
            <h2>Link Indisponível</h2>
            <p>Este link não está mais disponível.</p>
        {% endif %}
    </div>

    <!-- CARD -->
    <div class="card-summary">

        <div class="status-stripe
            {% if payment_link.status == 'expired' %}warning
            {% elif payment_link.status == 'canceled' %}danger
            {% else %}danger{% endif %}
        "></div>

        <div class="card-body">

            <div class="valor-container">
                <span class="valor-label">Valor</span>
                <div class="valor-destaque {{ payment_link.status }}">
                    R$ {{ payment_link.amount|floatformat:2 }}
                </div>

                <span class="status-pill {{ payment_link.status }}">
                    {% if payment_link.status == 'expired' %}
                        Venceu em {{ payment_link.expiration_date|default:payment_link.updated_at|date:"d/m/Y" }}
                    {% elif payment_link.status == 'canceled' %}
                        Cancelado
                    {% else %}
                        Indisponível
                    {% endif %}
                </span>
            </div>

            <div class="divider"></div>

            <div class="detalhes-lista">
                <div class="detalhe-linha">
                    <span>Pedido</span>
                    <strong>{{ payment_link.order.name|default:"Pedido"|truncatechars:25 }}</strong>
                </div>
                <div class="detalhe-linha">
                    <span>Vendedor</span>
                    <strong>{{ payment_link.order.seller.name|default:"Loja" }}</strong>
                </div>
                <div class="detalhe-linha">
                    <span>ID do Link</span>
                    <span class="mono">#{{ payment_link.id|stringformat:"06d" }}</span>
                </div>
            </div>

        </div>
    </div>

    <!-- AÇÕES -->
    <div class="actions-section">

        {% if payment_link.status == 'expired' or payment_link.status == 'canceled' %}
            <p class="help-text">
                Precisa concluir o pagamento? Solicite um novo link.
            </p>

            <a
                href="https://api.whatsapp.com/send?phone=55{{ payment_link.order.seller.phone|default:''|urlencode }}&text={{ 'Olá, o link do pedido #'|add:payment_link.order.pk|add:' expirou. Poderia gerar um novo?'|urlencode }}"
                target="_blank"
                class="btn-action primary"
            >
                <i class="bi bi-whatsapp"></i> Contatar Vendedor
            </a>
        {% endif %}

        <a href="/" class="btn-action ghost">
            <i class="bi bi-arrow-left"></i> Voltar ao início
        </a>

    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>

/* ===== LAYOUT ===== */
.status-page {
    max-width: 480px;
    margin: 40px auto;
    padding: 0 20px;
    font-family: Inter, system-ui, sans-serif;
}

/* ===== HEADER ===== */
.status-header {
    text-align: center;
    margin-bottom: 32px;
}

.status-header h2 {
    font-size: 1.8rem;
    font-weight: 800;
    margin: 16px 0 6px;
}

.status-header p {
    color: #6b7280;
}

/* ===== ICON ===== */
.status-icon-lg {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    color: #fff;
    font-size: 1.8rem;
    animation: popIn .6s ease;
}

.status-icon-lg.warning {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.status-icon-lg.danger {
    background: linear-gradient(135deg, #ef4444, #b91c1c);
}

/* ===== CARD ===== */
.card-summary {
    background: #fff;
    border-radius: 22px;
    box-shadow: 0 20px 30px rgba(0,0,0,.06);
    overflow: hidden;
}

.status-stripe {
    height: 6px;
}

.status-stripe.warning { background: #f59e0b; }
.status-stripe.danger { background: #ef4444; }

.card-body {
    padding: 24px;
}

/* ===== VALOR ===== */
.valor-container {
    text-align: center;
}

.valor-label {
    font-size: .75rem;
    text-transform: uppercase;
    color: #9ca3af;
    font-weight: 700;
}

.valor-destaque {
    font-size: 2.2rem;
    font-weight: 800;
    margin: 6px 0;
}

.valor-destaque.expired,
.valor-destaque.canceled {
    opacity: .6;
    text-decoration: line-through;
}

/* ===== STATUS ===== */
.status-pill {
    display: inline-block;
    margin-top: 8px;
    padding: 6px 14px;
    border-radius: 999px;
    font-size: .8rem;
    font-weight: 600;
}

.status-pill.expired {
    background: #fef3c7;
    color: #92400e;
}

.status-pill.canceled {
    background: #fee2e2;
    color: #991b1b;
}

/* ===== DETALHES ===== */
.divider {
    height: 1px;
    background: #f3f4f6;
    margin: 20px 0;
}

.detalhes-lista {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.detalhe-linha {
    display: flex;
    justify-content: space-between;
    font-size: .95rem;
    color: #4b5563;
}

.mono {
    font-family: monospace;
    color: #6b7280;
}

/* ===== ACTIONS ===== */
.actions-section {
    margin-top: 28px;
    text-align: center;
}

.help-text {
    margin-bottom: 14px;
    color: #6b7280;
    font-size: .9rem;
}

.btn-action {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 14px;
    border-radius: 14px;
    font-weight: 600;
    text-decoration: none;
    transition: .2s;
}

.btn-action.primary {
    background: #111827;
    color: #fff;
}

.btn-action.primary:hover {
    transform: translateY(-2px);
}

.btn-action.ghost {
    margin-top: 10px;
    color: #6b7280;
}

.btn-action.ghost:hover {
    background: #f9fafb;
}

/* ===== ANIMATION ===== */
@keyframes popIn {
    from { opacity: 0; transform: scale(.7); }
    to { opacity: 1; transform: scale(1); }
}

</style>
{% endblock %}
