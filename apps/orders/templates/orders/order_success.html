{% extends 'base.html' %}

{% block title %}Link Criado{% endblock %}
{% block nav_links %}active{% endblock %}

{% block content %}
<div class="success-page">

    <!-- Header -->
    <div class="success-header">
        <div class="success-icon-lg">
            <i class="bi bi-check-lg"></i>
        </div>
        <h2>Link Criado!</h2>
        <p>Seu link de pagamento está pronto para ser enviado</p>
    </div>

    <!-- Card Resumo -->
    <div class="card-app mb-3">
        <div class="card-body">

            <div class="text-center mb-4">
                <span class="valor-label">Valor do Link</span>
                <div class="valor-destaque">R$ {{ order.total }}</div>

                {% if order.installments %}
                    {% widthratio order.total order.installments 1 as parcela_bruta %}
                    <span class="parcelas-info">
                        em até {{ order.installments }}x
                        de R$ {{ parcela_bruta|floatformat:2 }}
                        sem juros
                    </span>
                {% else %}
                    <span class="parcelas-info">Pagamento à vista</span>
                {% endif %}
            </div>

            <div class="detalhes-resumo">
                <div class="detalhe-item">
                    <span class="detalhe-label">Cliente</span>
                    <span class="detalhe-valor">{{ order.name }}</span>
                </div>
                <div class="detalhe-item">
                    <span class="detalhe-label">Vendedor</span>
                    <span class="detalhe-valor">{{ order.seller.name }}</span>
                </div>
                <div class="detalhe-item">
                    <span class="detalhe-label">Valor do Produto</span>
                    <span class="detalhe-valor">R$ {{ order.value }}</span>
                </div>
                <div class="detalhe-item">
                    <span class="detalhe-label">Frete</span>
                    <span class="detalhe-valor">R$ {{ order.value_freight }}</span>
                </div>
                <div class="detalhe-item">
                    <span class="detalhe-label">Parcelas</span>
                    <span class="detalhe-valor">
                        {% if order.installments %}
                            {{ order.installments }}x sem juros
                        {% else %}
                            À vista
                        {% endif %}
                    </span>
                </div>
                <div class="detalhe-item">
                    <span class="detalhe-label">Valor Final</span>
                    <span class="detalhe-valor">R$ {{ order.total }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Card Link -->
    <div class="card-app mb-4">
        <div class="card-body">
            <label class="form-label-sm mb-2">Link de Pagamento</label>

            {% if payment_link %}
                <div class="link-box">
                    <input type="text"
                           class="link-input"
                           id="linkGerado"
                           value="{{ payment_link.url_link }}"
                           readonly>

                    <button type="button" class="btn-copiar" id="btnCopiar">
                        <i class="bi bi-copy"></i>
                    </button>
                </div>

                <div class="text-center mt-2">
                    <small class="msg-copiado" id="msgCopiado">
                        <i class="bi bi-check-circle-fill me-1"></i>Link copiado!
                    </small>
                </div>
            {% else %}
                <p class="text-danger text-center">
                    Nenhum link de pagamento encontrado.
                </p>
            {% endif %}
        </div>
    </div>

    <!-- Ações -->
    <div class="acoes-grid">
        <button type="button" class="btn-acao btn-whatsapp" id="btnWhatsApp">
            <i class="bi bi-whatsapp"></i>
            <span>Enviar no WhatsApp</span>
        </button>

        <button type="button" class="btn-acao btn-compartilhar" id="btnCompartilhar">
            <i class="bi bi-share"></i>
            <span>Compartilhar</span>
        </button>
    </div>

    <!-- Criar Novo -->
    <div class="d-grid mt-4">
        <a href="{% url 'orders:order-create' %}" class="btn btn-app btn-outline-app">
            <i class="bi bi-plus-lg me-2"></i>Criar Novo Link
        </a>
    </div>

    <!-- Voltar -->
    <div class="text-center mt-3">
        <a href="#" class="link-voltar">
            <i class="bi bi-arrow-left me-1"></i>Ver todos os links
        </a>
    </div>

</div>
{% endblock %}

{% block extra_css %}
<style>
.success-page {
    padding-top: 20px;
}

/* Header */
.success-header {
    text-align: center;
    margin-bottom: 32px;
}

.success-icon-lg {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    animation: scaleIn 0.4s ease;
}

.success-icon-lg i {
    font-size: 2.5rem;
    color: #fff;
}

@keyframes scaleIn {
    0% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
}

/* Valor */
.valor-label {
    font-size: .8rem;
    color: var(--gray-500);
    text-transform: uppercase;
}

.valor-destaque {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 8px 0;
}

.parcelas-info {
    font-size: .9rem;
    color: var(--success);
}

/* Detalhes */
.detalhes-resumo {
    background: var(--gray-50);
    border-radius: 12px;
    padding: 16px;
}

.detalhe-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--gray-100);
}

.detalhe-item:last-child {
    border-bottom: none;
}

/* Link */
.link-box {
    display: flex;
    border-radius: 12px;
    border: 1.5px solid var(--gray-200);
    background: var(--gray-50);
}

.link-input {
    flex: 1;
    border: none;
    padding: 14px 16px;
    background: transparent;
    font-family: monospace;
}

.link-input:focus {
    outline: none;
}

.btn-copiar {
    background: var(--primary);
    border: none;
    color: #fff;
    padding: 14px 18px;
}

.msg-copiado {
    opacity: 0;
    color: var(--success);
    transition: opacity .3s;
}

.msg-copiado.show {
    opacity: 1;
}

/* Ações */
.acoes-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.btn-acao {
    padding: 20px 16px;
    border-radius: 16px;
    border: none;
    font-weight: 600;
    cursor: pointer;
}

/* Botões */
.btn-whatsapp {
    background: #25D366;
    color: #fff;
}

.btn-compartilhar {
    background: var(--gray-100);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const linkGerado = document.getElementById('linkGerado');
    const btnCopiar = document.getElementById('btnCopiar');
    const msgCopiado = document.getElementById('msgCopiado');

    btnCopiar?.addEventListener('click', () => {
        linkGerado.select();
        navigator.clipboard.writeText(linkGerado.value);
        msgCopiado.classList.add('show');
        setTimeout(() => msgCopiado.classList.remove('show'), 2000);
    });
});
</script>
{% endblock %}
