{% extends "sales/base_mobile_seller.html" %}
{% load humanize %}

{% block title %}Dashboard{% endblock %}
{% block nav_home %}active{% endblock %}

{% block content %}
<div class="card-app bg-white text-center py-4">
    <small class="text-uppercase text-muted fw-bold" style="font-size: 0.7rem;">Total deste Mês</small>
    <h1 class="display-4 fw-bold mb-0 text-primary">R$ {{ total_month|floatformat:2 }}</h1>
    <p class="text-muted mb-0">{{ today|date:"F Y"|capfirst }}</p>
</div>

<h6 class="text-uppercase text-muted fw-bold mb-3 ms-1" style="font-size: 0.75rem;">Venda de Hoje</h6>

{% if sale_today %}
    <div class="card-app">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-1 fw-bold text-success">R$ {{ sale_today.amount|floatformat:2 }}</h5>
                <small class="text-muted"><i class="bi bi-clock me-1"></i>Lançado às {{ sale_today.created_at|date:"H:i" }}</small>
            </div>
            <a href="{% url 'sales:sale-edit' sale_today.pk %}" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                <i class="bi bi-pencil me-1"></i>Editar
            </a>
        </div>
    </div>
{% else %}
    <div class="card-app border-dashed border-2 border-light mb-4 text-center py-4">
        <i class="bi bi-calendar-plus fs-1 text-muted opacity-50 mb-2"></i>
        <p class="text-muted mb-3">Nenhuma venda lançada hoje.</p>
        <a href="{% url 'sales:sale-add' %}" class="btn btn-primary-app w-auto px-4 py-2">
            Lançar Venda de Hoje
        </a>
    </div>
{% endif %}

<!-- AÇÕES RÁPIDAS (NOVO) -->
<h6 class="text-uppercase text-muted fw-bold mb-3 ms-1 mt-4" style="font-size: 0.75rem;">Ferramentas</h6>
<div class="row g-2 mb-4">
    <div class="col-4">
        <a href="{% url 'orders:order-create' %}" class="card-app d-block text-decoration-none p-3 text-center h-100">
            <div class="rounded-circle bg-primary-light d-inline-flex p-2 mb-2 text-primary" style="background: rgba(99, 102, 241, 0.1);">
                <i class="bi bi-link-45deg fs-4"></i>
            </div>
            <div class="small fw-bold text-dark" style="font-size: 0.8rem;">Criar Link</div>
        </a>
    </div>
    <div class="col-4">
        <a href="{% url 'orders:order-list' %}" class="card-app d-block text-decoration-none p-3 text-center h-100">
            <div class="rounded-circle bg-success-light d-inline-flex p-2 mb-2 text-success" style="background: rgba(16, 185, 129, 0.1);">
                <i class="bi bi-receipt fs-4"></i>
            </div>
            <div class="small fw-bold text-dark" style="font-size: 0.8rem;">Pedidos</div>
        </a>
    </div>
    <div class="col-4">
        <a href="{% url 'orders:order-frete' %}" class="card-app d-block text-decoration-none p-3 text-center h-100">
            <div class="rounded-circle bg-warning-light d-inline-flex p-2 mb-2 text-warning" style="background: rgba(245, 158, 11, 0.1);">
                <i class="bi bi-truck fs-4"></i>
            </div>
            <div class="small fw-bold text-dark" style="font-size: 0.8rem;">Frete</div>
        </a>
    </div>
</div>

<h6 class="text-uppercase text-muted fw-bold mb-3 ms-1 mt-4" style="font-size: 0.75rem;">Histórico Recente</h6>

<div class="card-app p-0 overflow-hidden">
    {% for sale in recent_sales %}
        <div class="d-flex align-items-center p-3 border-bottom {% if forloop.last %}border-0{% endif %}">
            <div class="rounded-3 bg-light d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
                <i class="bi bi-bag-check text-primary fs-5"></i>
            </div>
            <div class="flex-grow-1">
                <h6 class="mb-0 fw-bold">R$ {{ sale.amount|floatformat:2 }}</h6>
                <small class="text-muted">{{ sale.date|date:"d/m/Y" }}</small>
            </div>
            <div class="text-end">
                <span class="badge bg-light text-dark">{{ sale.date|date:"l"|slice:":3" }}</span>
            </div>
        </div>
    {% empty %}
        <div class="text-center py-5">
            <p class="text-muted mb-0">Nenhum histórico disponível</p>
        </div>
    {% endfor %}
</div>
{% endblock %}
